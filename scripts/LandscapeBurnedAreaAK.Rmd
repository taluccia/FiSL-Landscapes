0---
title: "Landscape plus burned area"
author: "Anna Talucci"
date: "2023-06-07"
output: html_document
---

# Overview

This script generates the burned area  for within the landscape area

# Packages
```{r}
library(terra)
library(gdalUtilities)
library(sf)
library(tidyverse)
```

# Data

## State

```{r}
akState = st_read("../data/Boundaries/AlaskaState3338.shp", "AlaskaState3338")
```

```{r}
Landscapes = st_read("../data/Landscapes/final_plots_lat_lon.shp", "final_plots_lat_lon")
```

```{r}
akFires = st_read("../data/Fires/AlaskaFires3338.shp", "AlaskaFires3338")
```


# Select Landscapes for Alaska
```{r}
Landscapes
unique(Landscapes$ecoregion)
```

```{r}
( akLandscapes = Landscapes %>% filter(ecoregion=="ALASKA BOREAL INTERIOR"))
```

# Reproject
```{r}
ak_landscapes = st_transform(akLandscapes, crs = 3338)
```



# Map
```{r}
ggplot() +
     geom_sf(data = akState, fill = "#C0C0C0", colour="#A9AB9D") +
  geom_sf(data = akFires, fill=NA, color = "orange") +
  geom_sf(data = ak_landscapes, fill=NA, color = "blue") +
    coord_sf()
```
# Overlay Landscapes and fire perimeters

## Intersection
This clips the fire perimeters and keeps only the portion within the landscape.
```{r}
ak_intersection<-st_intersection( akFires, ak_landscapes) %>% 
  dplyr::mutate(fireYr = lubridate::year(Ig_Date), 
                month = lubridate::month(Ig_Date), 
                day = lubridate::day(Ig_Date)) %>%
  filter(fireYr>= 2000) 


ak_intersection
```

## Intersect
This keeps wth full fire perimeter
```{r}

( selectFires = akFires %>% st_filter(ak_landscapes, .predicates = st_intersects) %>%
  dplyr::mutate(fireYr = lubridate::year(Ig_Date), 
                month = lubridate::month(Ig_Date), 
                day = lubridate::day(Ig_Date)) %>%
  st_join(., ak_landscapes) %>% 
  filter(fireYr>= 2000) 
)

unique(selectFires$fireYr)
  
```
```{r}
glimpse(selectFires)
```


# Map
```{r}
ggplot() + 
  geom_sf(data = ak_intersection, color = "orange") +
  geom_sf(data = ak_landscapes, fill=NA, color = "blue") +
  coord_sf()
```

```{r}
ggplot() + 
  geom_sf(data = selectFires, color = "orange") +
  geom_sf(data = ak_landscapes, fill=NA, color = "blue") +
  coord_sf()
```

# Reproject to WGS 84
```{r}
ak_intersectionWgs = st_transform(ak_intersection, crs = 4326)
ak_intersectionWgs
selectFiresWgs = st_transform(selectFires, crs = 4326)
selectFiresWgs
```
# write  to shp

## burned area 

```{r eval=FALSE, include=FALSE}
st_write(ak_intersection, "../outputs/shp/AkBaLf3338.shp", driver="ESRI Shapefile")
```

```{r eval=FALSE, include=FALSE}
st_write(ak_intersectionWgs, "../outputs/shp/AkBaLf4326.shp", driver="ESRI Shapefile")
```

# select fires
```{r eval=FALSE, include=FALSE}
st_write(selectFires, "../outputs/selectFires/LsAkFires.shp", driver="ESRI Shapefile")
```

```{r eval=FALSE, include=FALSE}
st_write(selectFiresWgs, "../outputs/selectFires/LsAkFires4326.shp", driver="ESRI Shapefile")
```